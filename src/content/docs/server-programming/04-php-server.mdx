---
title: PHP en el Servidor
description: Aprende a usar PHP en el servidor y cómo funciona el ciclo de vida de una petición HTTP.
---

import { FileTree, Card, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

# PHP en el Servidor

PHP es un lenguaje de programación especialmente diseñado para el desarrollo web del lado del servidor. Cuando se ejecuta en Apache, permite crear páginas web dinámicas que pueden interactuar con bases de datos y generar contenido HTML en tiempo real.

## Fundamentos del servidor PHP

### ¿Cómo funciona PHP en Apache?

<Card title="Ciclo de vida de una petición PHP" icon="information">
  1. El navegador solicita una página PHP al servidor
  2. Apache recibe la solicitud y reconoce la extensión `.php`
  3. Apache pasa el archivo al intérprete PHP
  4. PHP procesa el código y genera HTML como resultado
  5. Apache envía el HTML generado al navegador
  6. El navegador muestra la página al usuario
</Card>

:::note
Por defecto, Laragon viene con Apache y PHP preinstalados. Esto facilita enormemente el desarrollo, ya que solo necesitas crear un nuevo proyecto y abrirlo en el navegador.
:::

### Ubicación de archivos PHP

Al igual que los archivos HTML, los archivos PHP deben estar en la carpeta raíz del servidor web:

<FileTree>
- www/ (o htdocs/)
  - index.php
  - contacto.php
  - proyectos/
    - index.php
    - detalles.php
</FileTree>

:::tip[Entornos de desarrollo comunes]
- **Laragon**: Carpeta `www`
- **XAMPP/WampServer**: Carpeta `htdocs`
:::

## Enrutamiento en PHP

:::caution[Convención de URLs]
Para facilitar la lectura, usaremos una notación abreviada para las URLs:
- `/` se refiere a `http://localhost/`
- `/index.php` se refiere a `http://localhost/index.php`
- `/contacto.php` se refiere a `http://localhost/contacto.php`
:::

PHP utiliza un **enrutamiento basado en archivos**. Esto significa que el nombre del archivo PHP se convierte directamente en la URL de la página:

| Archivo | URL |
|---------|-----|
| `index.php` | `/` o `/index.php` |
| `contacto.php` | `/contacto.php` |
| `proyectos/detalles.php` | `/proyectos/detalles.php` |

:::tip[Archivos de índice]
Apache tiene una jerarquía predefinida cuando se accede a una carpeta:
1. **index.php**: Es el archivo por defecto con primera prioridad
2. **index.html**: Se carga si no existe index.php
:::

Veamos un ejemplo de estructura de archivos y sus correspondientes URLs:

<FileTree>
- index.php → `/` o `/index.php`
- contacto.php → `/contacto.php`
- operaciones/
  - añadir.php → `/operaciones/anadir.php`
  - eliminar.php → `/operaciones/eliminar.php`
  - index.php → `/operaciones/` o `/operaciones/index.php`
</FileTree>

## Primeros pasos con PHP

### Tu primer script PHP

<Steps>
1. Crea un archivo llamado `hola.php` en tu directorio raíz.

2. Escribe el siguiente código PHP:
   ```php
   <?php
   // Esto es un comentario en PHP
   echo "<h1>¡Hola, mundo!</h1>";
   echo "<p>Esta es mi primera página PHP.</p>";
   echo "<p>La fecha actual del servidor es: " . date("Y-m-d H:i:s") . "</p>";
   ?>
   ```

3. Abre un navegador y visita `http://localhost/hola.php`.

4. Verás el texto formateado como HTML y la fecha actual del servidor.
</Steps>

### PHP y HTML trabajando juntos

La verdadera potencia de PHP está en su capacidad para combinarse con HTML. Puedes alternar entre código PHP y HTML en un mismo archivo:

```php
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi primera página PHP</title>
</head>
<body>
    <header>
        <h1>Bienvenido a mi sitio</h1>
    </header>
    
    <main>
        <?php
        // Código PHP para generar contenido dinámico
        echo "<h2>Hola, mundo!</h2>";
        ?>
        <p>La fecha es: <?php echo date("d/m/Y"); ?></p>
    </main>

</body>
</html>
```

## Formularios en PHP

Los formularios HTML son una forma común de interactuar con los usuarios. PHP proporciona mecanismos para procesar los datos enviados.

### Atributos importantes

<Tabs>
  <TabItem label="action">
    El atributo `action` del formulario indica a dónde se enviarán los datos:
    
    ```html
    <form action="procesar.php">
    ```
  </TabItem>
  <TabItem label="method">
    El atributo `method` especifica cómo se enviarán los datos:
    
    ```html
    <form method="POST">
    <!-- o -->
    <form method="GET">
    ```
  </TabItem>
  <TabItem label="name">
    El atributo `name` de cada campo define la clave para acceder a su valor en PHP:
    
    ```html
    <input type="text" name="username">
    <!-- En PHP: $_POST['username'] o $_GET['username'] -->
    ```
  </TabItem>
</Tabs>

### Métodos de envío

#### El método GET

<Card title="Método GET" icon="warning">
El método GET comunmente se usa para **pedir** datos al servidor. Los datos se envían como parte de la URL.

**Importante**: No es seguro para enviar datos sensibles ya que son visibles en la URL y pueden ser vistos en el historial del navegador.
</Card>

```html
<form action="procesar.php" method="GET">
    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" name="nombre" required>
    
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    
    <input type="submit" value="Enviar">
</form>
```

Para procesar los datos enviados por GET, se utiliza la variable superglobal `$_GET`:

```php
<?php
// procesar.php
$nombre = $_GET['nombre'];
$email = $_GET['email'];
echo "<h1>Hola, $nombre</h1>";
echo "<p>Tu email es: $email</p>";
?>
```

#### El método POST

<Card title="Método POST" icon="approve">
Método recomendado para enviar datos al servidor, especialmente cuando:
- Se envían datos sensibles
- La cantidad de datos es grande
- Se modificarán datos en el servidor
</Card>

```html
<form action="procesar.php" method="POST">
    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" name="nombre" required>
    
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    
    <input type="submit" value="Enviar">
</form>
```

Para procesar los datos enviados por POST, se utiliza la variable superglobal `$_POST`:

```php
<?php
// procesar.php
$nombre = $_POST['nombre'];
$email = $_POST['email'];
echo "<h1>Hola, $nombre</h1>";
echo "<p>Tu email es: $email</p>";
?>
```

## Conexion a bases de datos
:::danger
Para esta seccion debera conocer los siguientes elementos del lenguaje PHP:
- Variables
- Tipos de datos
- Estructuras de control
- Funciones
- Arrays
- Objetos
:::
PHP tiene extensiones para conectarse a diferentes tipos de bases de datos. La más común es MySQL, que se utiliza junto con el sistema de gestión de bases de datos MySQL o MariaDB.
### Conexión a MySQL con PHP
Para conectarse a una base de datos MySQL, se utiliza la extensión `mysqli` o `PDO`. Aquí hay un ejemplo básico de cómo conectarse a una base de datos usando `mysqli`:

```php
<?php
// Conectar a la base de datos
$conexion = mysqli_connect("localhost", "usuario", "contraseña", "nombre_base_datos", 3306);
if (!$conexion) {
    die("Error de conexión: " . mysqli_connect_error());
}

echo "Conexión exitosa a la base de datos.";
```
Lo recomendable es usar variables que guarden los datos de conexión a la base de datos.
```php
<?php
// Datos de conexión
$host = "localhost";
$user = "root";
$password = "";
$database = "mi_base_datos";
$port = 3306;

// Conectar a la base de datos
$conexion = mysqli_connect($host, $user, $password, $database, $port);
```
### Consultas a la base de datos
Una vez tengamos el objeto de conexión, podemos realizar consultas a la base de datos. Aquí hay un ejemplo de cómo seleccionar datos de una tabla llamada `usuarios`:

```php
<?php
// Consulta a la base de datos
$query = "SELECT * FROM usuarios";
$resultado = mysqli_query($conexion, $query);
if (!$resultado) {
    die("Error en la consulta: " . mysqli_error($conexion));
}
```

#### La funcion `mysqli_fetch_assoc()`
Para recorrer los resultados de la consulta usamos el metodo `mysqli_fetch_assoc()` que devuelve un array asociativo con los resultados de la consulta.
```php
<?php
// Recorrer los resultados
$fila = mysqli_fetch_assoc($resultado);
print_r($fila);
$fila = mysqli_fetch_assoc($resultado);
print_r($fila);
```
Como puede ver obtenemos un array asociativo con una fila de la tabla `usuarios`. Podemos usar un bucle `while` para recorrer todos los resultados de la consulta:
```php
<?php
// Recorrer todos los resultados
while ($fila = mysqli_fetch_assoc($resultado)) {
    echo "ID: " . $fila['id'] . "<br>";
    echo "Nombre: " . $fila['nombre'] . "<br>";
    echo "Email: " . $fila['email'] . "<br>";
    echo "<hr>";
}
```
El bucle se detendra cuando no haya mas filas que recorrer. En este caso, el bucle se detendra cuando `mysqli_fetch_assoc()` devuelva `false`.

#### Cerrar la conexión

Es importante cerrar la conexión a la base de datos una vez que hayas terminado de usarla. Puedes hacerlo con la función `mysqli_close()`:

```php
<?php
// Cerrar la conexión
mysqli_close($conexion);
```
### Insertar datos en la base de datos
Para insertar datos en la base de datos, se utiliza la sentencia `INSERT INTO`. Aquí hay un ejemplo de cómo insertar un nuevo usuario en la tabla `usuarios`:

```php
<?php
// Datos a insertar
$nombre = "Juan Pérez";
